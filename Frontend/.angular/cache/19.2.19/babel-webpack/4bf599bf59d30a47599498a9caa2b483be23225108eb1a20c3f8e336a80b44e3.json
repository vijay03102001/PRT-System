{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { HttpClient, HttpClientModule, HttpParams } from '@angular/common/http';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nlet AllocationUtilizationComponent = class AllocationUtilizationComponent {\n  fb;\n  snackBar;\n  baseUrl = 'http://localhost:8080/api';\n  http = inject(HttpClient);\n  // Form Group\n  resourceAllocationForm;\n  // Dropdown Data\n  projects = [];\n  resources = [];\n  purchaseOrders = [];\n  // Utilization Table Data\n  utilizationData = [];\n  // Filters\n  projectFilter = null;\n  poFilter = null;\n  constructor(fb, snackBar) {\n    this.fb = fb;\n    this.snackBar = snackBar;\n    // Initialize the form\n    this.resourceAllocationForm = this.fb.group({\n      project: ['', Validators.required],\n      resource: ['', Validators.required],\n      purchaseOrder: ['', Validators.required],\n      allocatedHours: [0, [Validators.required, Validators.min(0)]]\n    });\n  }\n  ngOnInit() {\n    // Fetch dropdown data\n    this.loadProjects();\n    this.loadResources();\n    this.loadPurchaseOrders();\n  }\n  loadProjects() {\n    this.http.get(`${this.baseUrl}/projects`).subscribe({\n      next: data => this.projects = data,\n      error: () => this.showNotification('Failed to load projects', true)\n    });\n  }\n  loadResources() {\n    this.http.get(`${this.baseUrl}/resources`).subscribe({\n      next: data => this.resources = data,\n      error: () => this.showNotification('Failed to load resources', true)\n    });\n  }\n  loadPurchaseOrders() {\n    this.http.get(`${this.baseUrl}/pos`).subscribe({\n      next: data => this.purchaseOrders = data,\n      error: () => this.showNotification('Failed to load purchase orders', true)\n    });\n  }\n  // Load utilization data with filters\n  loadUtilizationData() {\n    if (this.projectFilter !== null && this.poFilter !== null) {\n      let params = new HttpParams().set('projectId', this.projectFilter.toString()).set('poId', this.poFilter.toString());\n      this.http.get(`${this.baseUrl}/resource/utilization`, {\n        params\n      }).subscribe({\n        next: data => {\n          this.utilizationData = data;\n        },\n        error: error => {\n          this.showNotification('Failed to load utilization data: ' + (error.error || error.message || 'Unknown error'), true);\n          this.utilizationData = [];\n        }\n      });\n    } else {\n      // Clear data if either filter is not set\n      this.utilizationData = [];\n    }\n  }\n  // Submit resource allocation\n  onSubmit() {\n    if (this.resourceAllocationForm.valid) {\n      const allocationDTO = {\n        projectId: this.resourceAllocationForm.get('project')?.value,\n        resourceId: this.resourceAllocationForm.get('resource')?.value,\n        poId: this.resourceAllocationForm.get('purchaseOrder')?.value,\n        allocatedHours: this.resourceAllocationForm.get('allocatedHours')?.value\n      };\n      this.http.post(`${this.baseUrl}/resource/allocation`, allocationDTO).subscribe({\n        next: response => {\n          this.showNotification('Resource allocated successfully');\n          // If both filters are set and match the allocated resource, refresh the data\n          if (this.projectFilter === allocationDTO.projectId && this.poFilter === allocationDTO.poId) {\n            this.loadUtilizationData();\n          }\n          // Reset form after submission\n          this.resourceAllocationForm.reset();\n        },\n        error: error => {\n          this.showNotification('Failed to allocate resource: ' + (error.error || error.message || 'Unknown error'), true);\n        }\n      });\n    }\n  }\n  // Filter methods\n  applyProjectFilter(event) {\n    const target = event.target;\n    const projectId = target.value;\n    this.projectFilter = projectId ? Number(projectId) : null;\n    this.loadUtilizationData();\n  }\n  applyPOFilter(event) {\n    const target = event.target;\n    const poId = target.value;\n    this.poFilter = poId ? Number(poId) : null;\n    this.loadUtilizationData();\n  }\n  // Reset filters\n  resetFilters() {\n    this.projectFilter = null;\n    this.poFilter = null;\n    // Reset select elements in the DOM\n    const projectSelect = document.getElementById('projectFilter');\n    const poSelect = document.getElementById('poFilter');\n    if (projectSelect) projectSelect.value = '';\n    if (poSelect) poSelect.value = '';\n    // Clear the utilization data\n    this.utilizationData = [];\n  }\n  showNotification(message, isError = false) {\n    this.snackBar.open(message, 'Close', {\n      duration: 3000,\n      horizontalPosition: 'right',\n      verticalPosition: 'top',\n      panelClass: isError ? ['error-snackbar'] : ['success-snackbar']\n    });\n  }\n};\nAllocationUtilizationComponent = __decorate([Component({\n  selector: 'app-allocation-utilization',\n  standalone: true,\n  imports: [CommonModule, FormsModule, ReactiveFormsModule, HttpClientModule, MatSnackBarModule],\n  templateUrl: './allocation-utilization.component.html',\n  styleUrl: './allocation-utilization.component.css'\n})], AllocationUtilizationComponent);\nexport { AllocationUtilizationComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}