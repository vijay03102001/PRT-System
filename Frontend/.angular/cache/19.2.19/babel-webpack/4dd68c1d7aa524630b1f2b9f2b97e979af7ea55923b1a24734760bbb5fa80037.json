{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, inject } from '@angular/core';\nimport { CommonModule, CurrencyPipe } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { HttpClient, HttpClientModule } from '@angular/common/http';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatButtonModule } from '@angular/material/button';\nlet ReportsComponent = class ReportsComponent {\n  fb;\n  snackBar;\n  currencyPipe;\n  baseUrl = 'http://localhost:8080/api';\n  http = inject(HttpClient);\n  detailedReports = [];\n  constructor(fb, snackBar, currencyPipe) {\n    this.fb = fb;\n    this.snackBar = snackBar;\n    this.currencyPipe = currencyPipe;\n  }\n  ngOnInit() {\n    this.loadDetailedReports(); // Initially load reports without any filters\n  }\n  loadDetailedReports() {\n    const url = `${this.baseUrl}/reports/all`;\n    this.http.get(url).subscribe({\n      next: data => {\n        console.log(\"API Response:\", data);\n        this.detailedReports = this.flattenData(data);\n      },\n      error: () => this.showNotification('Failed to load detailed reports', true)\n    });\n  }\n  flattenData(data) {\n    const flattenedData = [];\n    data.forEach(item => {\n      // For each purchase order, create an entry with each resource\n      item.purchaseOrders.forEach(po => {\n        // If there are no resources, still show the PO with empty resource fields\n        if (item.resources.length === 0) {\n          flattenedData.push({\n            poId: po.poId.toString(),\n            poNumber: po.poNumber,\n            projectId: item.project.projectId.toString(),\n            projectName: item.project.projectName,\n            resourceName: '',\n            designationName: '',\n            value: po.value,\n            poUtilized: po.poUtilized,\n            poBalance: po.poBalance\n          });\n        } else {\n          // Create an entry for each resource\n          item.resources.forEach(resource => {\n            flattenedData.push({\n              poId: po.poId.toString(),\n              poNumber: po.poNumber,\n              projectId: item.project.projectId.toString(),\n              projectName: item.project.projectName,\n              resourceName: resource.resourceName,\n              designationName: resource.designationName,\n              value: po.value,\n              poUtilized: po.poUtilized,\n              poBalance: po.poBalance\n            });\n          });\n        }\n      });\n    });\n    return flattenedData;\n  }\n  exportToExcel() {\n    let url = `${this.baseUrl}/reports/export`;\n    const params = [];\n    this.http.get(url, {\n      responseType: 'blob'\n    }).subscribe({\n      next: blob => this.downloadFile(blob, 'Reports.xlsx'),\n      error: () => this.showNotification('Failed to export Excel report', true)\n    });\n  }\n  downloadFile(blob, filename) {\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(link.href);\n  }\n  showNotification(message, isError = false) {\n    this.snackBar.open(message, 'Close', {\n      duration: 3000,\n      horizontalPosition: 'right',\n      verticalPosition: 'top',\n      panelClass: isError ? ['error-snackbar'] : ['success-snackbar']\n    });\n  }\n};\nReportsComponent = __decorate([Component({\n  selector: 'app-reports',\n  templateUrl: './reports.component.html',\n  styleUrls: ['./reports.component.css'],\n  standalone: true,\n  imports: [CommonModule, FormsModule, HttpClientModule, MatSnackBarModule, MatButtonModule],\n  providers: [CurrencyPipe]\n})], ReportsComponent);\nexport { ReportsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}