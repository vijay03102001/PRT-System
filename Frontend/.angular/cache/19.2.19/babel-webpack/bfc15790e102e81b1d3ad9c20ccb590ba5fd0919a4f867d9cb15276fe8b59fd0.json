{"ast":null,"code":"import { inject } from '@angular/core';\nimport { CommonModule, CurrencyPipe } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { HttpClient, HttpClientModule } from '@angular/common/http';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatButtonModule } from '@angular/material/button';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"@angular/common\";\nfunction ReportsComponent_tr_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵtext(13);\n    i0.ɵɵpipe(14, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵpipe(17, \"currency\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const report_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(report_r1.poNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(report_r1.projectName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(report_r1.resourceName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(report_r1.designationName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(11, 7, report_r1.value));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(14, 9, report_r1.poUtilized));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(17, 11, report_r1.poBalance));\n  }\n}\nexport let ReportsComponent = /*#__PURE__*/(() => {\n  class ReportsComponent {\n    fb;\n    snackBar;\n    currencyPipe;\n    baseUrl = 'http://localhost:8080/api';\n    http = inject(HttpClient);\n    detailedReports = [];\n    constructor(fb, snackBar, currencyPipe) {\n      this.fb = fb;\n      this.snackBar = snackBar;\n      this.currencyPipe = currencyPipe;\n    }\n    ngOnInit() {\n      this.loadDetailedReports(); // Initially load reports without any filters\n    }\n    loadDetailedReports() {\n      const url = `${this.baseUrl}/reports/all`;\n      this.http.get(url).subscribe({\n        next: data => {\n          console.log(\"API Response:\", data);\n          this.detailedReports = this.flattenData(data);\n        },\n        error: () => this.showNotification('Failed to load detailed reports', true)\n      });\n    }\n    flattenData(data) {\n      const flattenedData = [];\n      data.forEach(item => {\n        // For each purchase order, create an entry with each resource\n        item.purchaseOrders.forEach(po => {\n          // If there are no resources, still show the PO with empty resource fields\n          if (item.resources.length === 0) {\n            flattenedData.push({\n              poId: po.poId.toString(),\n              poNumber: po.poNumber,\n              projectId: item.project.projectId.toString(),\n              projectName: item.project.projectName,\n              resourceName: '',\n              designationName: '',\n              value: po.value,\n              poUtilized: po.poUtilized,\n              poBalance: po.poBalance\n            });\n          } else {\n            // Create an entry for each resource\n            item.resources.forEach(resource => {\n              flattenedData.push({\n                poId: po.poId.toString(),\n                poNumber: po.poNumber,\n                projectId: item.project.projectId.toString(),\n                projectName: item.project.projectName,\n                resourceName: resource.resourceName,\n                designationName: resource.designationName,\n                value: po.value,\n                poUtilized: po.poUtilized,\n                poBalance: po.poBalance\n              });\n            });\n          }\n        });\n      });\n      return flattenedData;\n    }\n    exportToExcel() {\n      let url = `${this.baseUrl}/reports/export`;\n      const params = [];\n      this.http.get(url, {\n        responseType: 'blob'\n      }).subscribe({\n        next: blob => this.downloadFile(blob, 'Reports.xlsx'),\n        error: () => this.showNotification('Failed to export Excel report', true)\n      });\n    }\n    downloadFile(blob, filename) {\n      const link = document.createElement('a');\n      link.href = URL.createObjectURL(blob);\n      link.download = filename;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      URL.revokeObjectURL(link.href);\n    }\n    showNotification(message, isError = false) {\n      this.snackBar.open(message, 'Close', {\n        duration: 3000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top',\n        panelClass: isError ? ['error-snackbar'] : ['success-snackbar']\n      });\n    }\n    static ɵfac = function ReportsComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ReportsComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i3.CurrencyPipe));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ReportsComponent,\n      selectors: [[\"app-reports\"]],\n      features: [i0.ɵɵProvidersFeature([CurrencyPipe])],\n      decls: 34,\n      vars: 1,\n      consts: [[1, \"reports-container\"], [1, \"reports-header\"], [1, \"report-actions\"], [1, \"export-options\"], [1, \"btn-secondary\", 3, \"click\"], [1, \"report-results\"], [1, \"detailed-report\"], [1, \"report-table\"], [4, \"ngFor\", \"ngForOf\"]],\n      template: function ReportsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"h1\");\n          i0.ɵɵtext(3, \"Reports\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(4, \"section\", 2)(5, \"div\", 3)(6, \"button\", 4);\n          i0.ɵɵlistener(\"click\", function ReportsComponent_Template_button_click_6_listener() {\n            return ctx.exportToExcel();\n          });\n          i0.ɵɵtext(7, \" Export to Excel \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(8, \"div\", 3)(9, \"button\", 4);\n          i0.ɵɵlistener(\"click\", function ReportsComponent_Template_button_click_9_listener() {\n            return ctx.exportToExcel();\n          });\n          i0.ɵɵtext(10, \" Export to Pdf \");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(11, \"div\", 5)(12, \"div\", 6)(13, \"h2\");\n          i0.ɵɵtext(14, \"Detailed PO Breakdown\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(15, \"table\", 7)(16, \"thead\")(17, \"tr\")(18, \"th\");\n          i0.ɵɵtext(19, \"PO Number\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"th\");\n          i0.ɵɵtext(21, \"Project Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"th\");\n          i0.ɵɵtext(23, \"Resource Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"th\");\n          i0.ɵɵtext(25, \"Designation Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"th\");\n          i0.ɵɵtext(27, \"Value\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"th\");\n          i0.ɵɵtext(29, \"PO Utilized\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"th\");\n          i0.ɵɵtext(31, \"PO Balance\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(32, \"tbody\");\n          i0.ɵɵtemplate(33, ReportsComponent_tr_33_Template, 18, 13, \"tr\", 8);\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(33);\n          i0.ɵɵproperty(\"ngForOf\", ctx.detailedReports);\n        }\n      },\n      dependencies: [CommonModule, i3.NgForOf, i3.CurrencyPipe, FormsModule, HttpClientModule, MatSnackBarModule, MatButtonModule],\n      styles: [\"[_nghost-%COMP%]{display:block;width:calc(100% - 260px);margin-left:260px;min-height:calc(100vh - 60px);background-color:#e6f2ff;padding:20px;position:relative;box-sizing:border-box}.reports-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;padding:2rem;box-shadow:0 4px 6px #0000001a;display:flex;flex-direction:column;gap:2rem}.reports-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#010108;margin-bottom:1.5rem;border-bottom:2px solid #f0f0f0;padding-bottom:.5rem;font-size:3rem}.report-filters[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.filter-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.filter-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:.5rem;color:#030405;font-weight:600}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.75rem;border:1px solid #E0E0E0;border-radius:4px;outline:none;transition:all .3s ease}.filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border-color:#060607;box-shadow:0 0 5px #1e90ff4d}.report-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.export-options[_ngcontent-%COMP%]{display:flex;gap:1rem}.btn-primary[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]{padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-weight:500;text-transform:uppercase;letter-spacing:.5px;transition:all .3s ease;outline:none}.btn-primary[_ngcontent-%COMP%]{background-color:#000001;color:#fff;box-shadow:0 2px 4px #0000001a}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3;transform:translateY(-2px);box-shadow:0 4px 6px #00000026}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff;box-shadow:0 2px 4px #0000001a}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#28a745;transform:translateY(-2px);box-shadow:0 4px 6px #00000026}.report-results[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.summary-report[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .detailed-report[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#020304;margin-bottom:1.5rem;border-bottom:2px solid #f0f0f0;padding-bottom:.5rem}.report-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.report-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:#f0f8ff}.report-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem;text-align:left;color:#030404;border-bottom:2px solid #E0E0E0;font-weight:600}.report-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.report-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid #E0E0E0}@media (max-width: 1200px){[_nghost-%COMP%]{width:calc(100% - 200px);margin-left:200px}}@media (max-width: 768px){[_nghost-%COMP%]{width:100%;margin-left:0;padding:10px}}\"]\n    });\n  }\n  return ReportsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}